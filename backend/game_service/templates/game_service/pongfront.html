<!-- version de pong teste dans mon envirannement prive uniquement !!!! -->
<!DOCTYPE html>
{% load static %}
<style>
	body {
		background: black;
		margin: 0;
	}
	canvas {
	/* border: 1px solid white; */
	height: calc(100% * 0.6);
	width: 100% ;
	}
</style>

<canvas id="MyCanvas"></canvas>
<script>
	const canvas = document.getElementById('MyCanvas');
	const c = canvas.getContext('2d');
	console.log("TEST");
	//mise a l'echelle du canvas
	canvas.width = window.innerWidth;
	canvas.height = window.innerWidth * 0.6;

	class Paddle{

		constructor({position}){
			this.position = position
			this.velocity = {x : 0, y : 0}
			this.height = 0.1 * canvas.height
			this.width = 0.01 * canvas.width
		}

		draw() {
			c.fillStyle = 'white'
			c.fillRect(this.position.x, this.position.y, this.width, this.height)
		}

		update() {
			this.draw()
			if (this.position.y + this.velocity.y > 0
				&& this.position.y + this.height + this.velocity.y
				< canvas.height)
				this.position.y += this.velocity.y
		}
	}

	class Ball{
		constructor(){
			this.position = {x : 0.5 * canvas.width, y : 0.5 * canvas.height}
			this.speed = 5 //vitesse de la balle
			this.direction = {
				x : Math.random() >= 0.5 ? -this.speed : this.speed,
				y : Math.random() >= 0.5 ? -this.speed : this.speed
			} // direction de depart de la balle
			this.velocity = {x : this.direction.x, y : this.direction.y}
			this.height = 0.01 / 0.6 * canvas.height
			this.width = 0.01 * canvas.width
		}

		restart() {
			this.direction.x *= -1
			this.direction.y = Math.random() >= 0.5 ? -this.speed : this.speed
			this.position = {x : 0.5 * canvas.width, y : 0.5 * canvas.height}
			this.velocity = {x : this.direction.x, y : this.direction.y}

		}

		draw() {
			c.fillStyle = 'white'
			c.fillRect(this.position.x, this.position.y, this.width, this.height)
		}

		update() {
			this.draw()

			// collision haut bas
			if (this.position.y + this.velocity.y > 0
				&& this.position.y + this.height + this.velocity.y
				< canvas.height)
				this.position.y += this.velocity.y
			else
				this.velocity.y *= -1

			const rightSide = this.position.x + this.width + this.velocity.x
			const leftSide = this.position.x + this.velocity.x
			const bottomSide = this.position.y + this.height
			const topSide = this.position.y

			//colision paddle
			if (leftSide <= paddle1.position.x + paddle1.width &&
				bottomSide >= paddle1.position.y &&
				topSide <= paddle1.position.y + paddle1.height)
				this.velocity.x *= -1
			else if (rightSide >= paddle2.position.x &&
				bottomSide >= paddle2.position.y &&
				topSide <= paddle2.position.y + paddle2.height)
				this.velocity.x *= -1
			// comptage de points
			else if (this.position.x + this.velocity.x < 0)
				this.restart()
			else if (this.position.x + this.height + this.velocity.x 
				> canvas.width)
				this.restart()
			this.position.x += this.velocity.x
		}
	}

	const paddle1 = new Paddle({
		position : {x : 0.01 * canvas.width, y : 0.45 * canvas.height}
	})

	const paddle2 = new Paddle({
		position : {x : 0.98 * canvas.width, y : 0.45 * canvas.height}
	})

	const ball = new Ball()

	function animate() {
		requestAnimationFrame(animate)
		//refresh du fond noir
		c.fillStyle = 'black'
		c.fillRect(0, 0, canvas.width, canvas.height)
		//mouvement + dessin
		paddle1.update()
		paddle2.update()
		ball.update()
	}

	animate()

	//vitesse des paddles
	const speed = 10

	document.addEventListener('keydown', function(event) {
		if (event.key === "ArrowUp") {
			paddle2.velocity.y = -speed
		}
		if (event.key === "ArrowDown") {
			paddle2.velocity.y = +speed
		}
		if (event.key === "w") {
			paddle1.velocity.y = -speed
		}
		if (event.key === "s") {
			paddle1.velocity.y = +speed
		}
	});

	document.addEventListener('keyup', function(event) {
		if (event.key === "ArrowUp") {
			paddle2.velocity.y = 0
		}
		if (event.key === "ArrowDown") {
			paddle2.velocity.y = 0
		}
		if (event.key === "w") {
			paddle1.velocity.y = 0
		}
		if (event.key === "s") {
			paddle1.velocity.y = 0
		}
	});


</script>
</html>